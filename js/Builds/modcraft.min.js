var ModCraft={};!function(){function a(){function e(a,b,c){if(a in c)return c[a];for(var d=b.filter(function(b){return b.names.indexOf(a)>=0}),e=[],g=0;g<d.length;g++){var h=d[g];if("instance"in h)e.push(h.instance);else{var i=f(h.dependencies,h.constructor,b,c);e.push(i),(h.singleton||h.contextual)&&(h.instance=i)}}return e.length>1?e:e[0]}function f(a,b,c,d){function f(){b.apply(this,g)}var g=a.map(function(a){return e(a,c,d)});return f.prototype=b.prototype,new f}var g=this,h=[];Object.defineProperty(g,"register",{configurable:!1,enumerable:!0,value:{}}),Object.defineProperty(g.register,"instance",{configurable:!1,enumerable:!0,value:function(a,c){var d=new b(a,[],function(){});d.singleton=!0,d.instance=c,h.push(d)}}),Object.defineProperty(g.register,"singleton",{configurable:!1,enumerable:!0,value:function(a,c,d){var e=new b(a,c,d);e.singleton=!0,h.push(e)}}),Object.defineProperty(g.register,"contextual",{configurable:!1,enumerable:!0,value:function(a,c,d){var e=new b(a,c,d);e.contextual=!0,h.push(e)}}),Object.defineProperty(g.register,"transient",{configurable:!1,enumerable:!0,value:function(a,c,d){var e=new b(a,c,d);h.push(e)}}),Object.defineProperty(g,"branch",{configurable:!1,enumerable:!0,value:function(){for(var b=new a,c=0;c<h.length;c++){var d=h[c];"instance"in d&&d.singleton?b.register.instance(d.names,d.instance):d.singleton?b.register.singleton(d.names,d.dependencies,d.constructor):d.contextual?b.register.contextual(d.names,d.dependencies,d.constructor):b.register["transient"](d.names,d.dependencies,d.constructor)}return b}}),Object.defineProperty(g,"resolve",{configurable:!1,enumerable:!0,value:function(a,b){var g=h.map(function(a){return a.singleton?a:c(a)});if("string"==typeof a)return e(a,g,b||{});var i=arguments[0]instanceof Array?arguments[0]:[],j=d(arguments).filter(function(a){return"function"==typeof a})[0],b=arguments[arguments.length-1];if(b=b instanceof Array||"object"!=typeof b?{}:b,j="function"==typeof j?j:i.filter(function(a){return"function"==typeof a})[0],!j)throw"Can't Resolve";var i=i.filter(function(a){return"string"==typeof a});return f(i,j,g,b)}}),Object.defineProperty(g.resolve,"all",{configurable:!1,enumerable:!0,value:function(a){var b=g.resolve(a);return b instanceof Array?b:[b]}})}function b(a,b,c){if(this.names=d(a).filter(function(a){return"string"==typeof a}),!this.names.length)throw"Invalid Name(s)";if(this.constructor="function"==typeof c?c:"function"==typeof b?b:b instanceof Array?b.filter(function(a){return"function"==typeof a})[0]:!1,!this.constructor)throw"Invalid Constructor";this.dependencies=d(b).filter(function(a){return"string"==typeof a}),this.singleton=!1,this.contextual=!1}function c(a){var b={};for(var c in a)b[c]=a[c];return b}function d(a){if(a instanceof Array)return a;if("string"==typeof a)return[a];try{return Array.prototype.slice.call(a,0)}catch(b){return"undefined"==typeof a?[]:[a]}}Object.defineProperty(ModCraft,"DependencyResolver",{configurable:!1,enumerable:!0,value:a})}(),function(){function a(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];if("function"==typeof e[b]){var f=e.name||"nameless";console.log(c+" "+f),e[b]()}}}function b(a,b){b=b||{},b.service=function(b,d,e){a.register.singleton(c(b,"services"),d,e)},Object.defineProperty(this,"service",{configurable:!1,enumerable:!0,get:function(){return b.service}}),b.module=function(b,d,e){a.register.singleton(c(b,"modules"),d,e)},Object.defineProperty(this,"module",{configurable:!1,enumerable:!0,get:function(){return b.module}}),b.dependency=a.register.contextual,Object.defineProperty(this,"dependency",{configurable:!1,enumerable:!0,get:function(){return b.dependency}}),b.instance=a.register.instance,Object.defineProperty(this.dependency,"instance",{configurable:!1,enumerable:!0,get:function(){return b.instance}}),b.singleton=a.register.singleton,Object.defineProperty(this.dependency,"singleton",{configurable:!1,enumerable:!0,get:function(){return b.singleton}}),b.contextual=a.register.contextual,Object.defineProperty(this.dependency,"contextual",{configurable:!1,enumerable:!0,get:function(){return b.contextual}}),b["transient"]=a.register["transient"],Object.defineProperty(this.dependency,"transient",{configurable:!1,enumerable:!0,get:function(){return b["transient"]}})}function c(a,b){return a=a instanceof Array?a:"string"==typeof a?[a]:[],b=b instanceof Array?b:"string"==typeof b?[b]:[],a.concat(b)}var d=new ModCraft.DependencyResolver;ModCraft.Application=function(){function c(){f.module=function(){throw"Module added after start. Please use .dependency to register late dependencies."},f.service=function(){throw"Service added after start. Please use .dependency to register late dependencies."},c=function(){throw"Application already started."},console.log("Starting Application"),console.log("Loading Modules");var b=e.resolve.all("modules");a(b,"init","Initializing"),a(b,"start","Starting"),console.log("Application Ready")}var e=d.branch();e.register.instance("dependencies",e),e.register.instance("application",this);var f={};Object.defineProperty(this,"register",{configurable:!1,enumerable:!0,value:new b(e,f)}),Object.defineProperty(this,"resolve",{configurable:!1,enumerable:!0,value:e.resolve}),Object.defineProperty(this,"start",{configurable:!1,enumerable:!0,get:function(){return c}}),Object.freeze(this)},Object.defineProperty(ModCraft,"register",{configurable:!1,enumerable:!0,value:new b(d)}),Object.defineProperty(ModCraft,"resolve",{configurable:!1,enumerable:!0,value:d.resolve}),Object.defineProperty(ModCraft,"start",{configurable:!1,enumerable:!0,value:function(){var a=new ModCraft.Application;return a.start(),a}})}();